@model DetailsViewModel;

<head>
    <title>@Model.TourName</title>
    <link rel="stylesheet" href="~/css/gallerypictures.css" style="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css">

</head>


<div class="text-center mb-5">
    <h2>@Model.TourName</h2>
</div>


@if (Model.AllTourApplicationImages != null && Model.AllTourApplicationImages.Count > 0)
{

    <div class="container">
        <div class="gallery">
            @for (int i = 0; i < Model.AllTourApplicationImages.Count; i++)
            {
                @if (i == 0)
                {
                    <figure class="gallery__item gallery__item--4">
                        <a href="@("data:image/jpeg;base64," + Convert.ToBase64String(Model.AllTourApplicationImages[0].FileData))"
                           data-lightbox="gallery" style=""
                           data-title="@Model.TourName">
                            <img src="@("data:image/jpeg;base64," + Convert.ToBase64String(Model.AllTourApplicationImages[0].FileData))"
                                 alt="" class="img-fluid">
                        </a>
                    </figure>
                }
                else if (i == 1)
                {
                    <figure class="gallery__item gallery__item--2">
                        <a href="@("data:image/jpeg;base64," + Convert.ToBase64String(Model.AllTourApplicationImages[i].FileData))"
                           data-lightbox="gallery"
                           data-title="@Model.TourName">
                            <img src="@("data:image/jpeg;base64," + Convert.ToBase64String(Model.AllTourApplicationImages[i].FileData))"
                                 alt="" class="img-fluid">
                        </a>
                    </figure>
                }
                else if (i == 2)
                {
                    <figure class="gallery__item gallery__item--3">

                        <a href="@("data:image/jpeg;base64," + Convert.ToBase64String(Model.AllTourApplicationImages[i].FileData))"
                           data-lightbox="gallery"
                           data-title="@Model.TourName">

                            <img src="@("data:image/jpeg;base64," + Convert.ToBase64String(Model.AllTourApplicationImages[i].FileData))"
                                 alt="" class="img-fluid">
                        </a>
                    </figure>
                }
                else if (i == 3)
                {
                    <figure class="gallery__item gallery__item--1">
                        <a href="@("data:image/jpeg;base64," + Convert.ToBase64String(Model.AllTourApplicationImages[3].FileData))"
                           data-lightbox="gallery"
                           data-title="@Model.TourName">
                            <img src="@("data:image/jpeg;base64," + Convert.ToBase64String(Model.AllTourApplicationImages[3].FileData))"
                                 alt="" class="img-fluid">
                        </a>
                    </figure>



                }
                else if (i >= 4)
                {
                    <a class="d-none" href="@("data:image/jpeg;base64," + Convert.ToBase64String(Model.AllTourApplicationImages[i].FileData))"
                       data-lightbox="gallery"
                       data-title="@Model.TourName">
                        <img src="@("data:image/jpeg;base64," + Convert.ToBase64String(Model.AllTourApplicationImages[i].FileData))"
                             alt="" class="img-fluid">
                    </a>


                }

            }
        </div>


    </div>

}
else
{
    <div class="alert alert-warning">No images available for this tour.</div>
}

<div class="row mt-5">
    <div class="col-lg-6">
        <h4>Details</h4>
        <ul class="list-group list-group-flush">
            <li class="list-group-item"><strong>Duration:</strong> @Model.Duaration</li>
            <li class="list-group-item"><strong>Price Per Person:</strong> @Model.PricePerPerson.ToString("C2")</li>
            <li class="list-group-item"><strong>Category:</strong> @Model.Category</li>
            <li class="list-group-item"><strong>Location:</strong> @Model.LocationCountry</li>
            <li class="list-group-item"><strong>Meeting Point:</strong> @Model.MeetingPoint</li>
            <li class="list-group-item"><strong>What to bring and know before you go :</strong> @Model.KnowBeforeYouGo</li>
            <li class="list-group-item"><strong>Category:</strong> @Model.Category</li>
        </ul>
    </div>
    <div class="col-lg-5">
        <h4>Full description</h4>
        <p>@Model.FullDescription</p>
    </div>


    @*   @if (isUserGuide)*@
    <div>
        <form asp-controller="Tour" asp-action="DeleteTour" asp-route-tourId="@Model.Id" method="post" class="d-inline ml-2">
            <button type="submit" class="btn btn-danger">DeleteTour</button>
        </form>
        <a asp-controller="TourBooking" asp-action="BookingOnTour" asp-route-tourId="@Model.Id" class="btn btn-success d-inline ml-3">Tour bookings</a>
    </div>

</div>

@*TODO hide div for regulate users*@
<div class="row mt-5">
    <div class="col-lg-12" onclick="">
        <h4>Add a new image to your tour:</h4>
        <form method="post" enctype="multipart/form-data" asp-action="AddImage" asp-controller="TouristTour">
            <input type="hidden" name="tourId" value="@Model.Id" />
            <div class="form-group">
                <input type="file" name="imageFile" required class="form-control mb-3" />
                <button type="submit" class="btn btn-primary btn-block">Upload Image</button>
            </div>
        </form>
    </div>
</div>

<div class="row ms-5">
    <div id="addComment" onclick="showForm()">
        
    </div>
    <form method="post" >
        <div data-mdb-input-init class="form-outline w-100">
            <textarea class="form-control" id="Content" name="Content" rows="5"
                      style="background: #fff; flex-shrink:unset">
            </textarea>
        </div>
        <input type="hidden" id="TourId" name="TourId" value="@Model.Id">
        <div class="float-end mt-2 pt-1">

            <button type="button" for="Content" 
                id="postCommentBtn"
                    data-mdb-button-init data-mdb-ripple-init class="btn btn-primary btn-sm ">
                Post comment
            </button>

        </div>

    </form>

</div>





<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/5.0.0-beta3/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function () {
        $('#postCommentBtn').click(function () {
            var content = $('#Content').val().trim();
            var tourId = $('#TourId').val();

            if (content === "") {
                alert('Please enter a message.');
                return false;
            }

            $.ajax({
                url: '/Comment/CreateComment',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ Content: content, TourId: tourId }),
                success: function (response, textStatus) {
                    if (textStatus === "success") {
                        alert('Comment posted successfully');
                    } else {
                        alert('Error posting comment');
                    }
                    $('#Content').val(''); // Clear the textarea after AJAX call
                },
                error: function (xhr, textStatus, errorThrown) {
                    alert('Error posting comment: ' + xhr.statusText);
                }
            });
        });
    });
</script>

<script>
    lightbox.option({
        'resizeDuration': 200,
        'wrapAround': true,
        'alwaysShowNavOnTouchDevices': true
    });

</script>

<script>

    function deleteImage(fileName, tourId) {
        if (confirm('Are you sure you want to delete this image?')) {
            fetch(`/Tour/DelatePicture?fileName=${fileName}&tourId=${tourId}`, {
                method: 'POST'
            }).then(response => response.text()).then(data => {
                if (data === 'success') {
                    alert('Image deleted successfully');
                    location.reload();
                }
                else {
                    alert('Failed to delete image');
                }
            });
        }
    }

 
</script>


